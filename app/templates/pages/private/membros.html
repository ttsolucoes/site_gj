{% extends "base.html" %}

{% block title %}MEMBROS{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/membros.css') }}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <h1>PAINEL - MEMBROS</h1>

    <div class="tabs">
        <button class="tab-btn active" data-tab="aniversariantes">Aniversariantes</button>
        <button class="tab-btn" data-tab="info">Informacional</button>
        <button class="tab-btn" data-tab="att_info">Atualizar informações / Remover contar</button>
    </div>

    <div class="tab-content">
        <div class="tab-pane active" id="aniversariantes">
            <h2 class="text-xl mb-4">Aniversariantes</h2>
            <div class="bg-zinc-800 text-white p-4 rounded-xl shadow-md aniversariante-card">
            {% for user in usuario %}
                {% if user.data_nascimento %}
                <div class="bg-zinc-800 text-white p-4 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold">{{ user.nome_completo }}</h3>
                    <p>📅 {{ user.data_nascimento|datetimeformat("%d de %B") }}</p>
                    <p>📞 {{ user.telefone }}</p>
                    <p>📧 {{ user.email }}</p>
                </div>
                {% endif %}
            {% endfor %}
            </div>
        </div>
        <div class="tab-pane" id="info">
            <h2 class="text-xl mb-4">Informações dos Membros</h2>
            <div class="bg-white dark:bg-zinc-800 p-4 rounded-xl shadow-sm membro-card">
            {% for user in usuario %}
                {% if user.nome_completo %}
                    <div class="bg-white dark:bg-zinc-800 p-4 rounded-xl shadow-sm">
                    <h3 class="font-bold text-lg">{{ user.nome_completo }}</h3>
                    <p>📍 Endereço: {{ user.endereco }}</p>
                    <p>📞 Telefone principal: {{ user.telefone }}</p>
                    <p>🚨 Contato de Emergência: {{ user.contato_emergencia }}</p>
                    <p>📧 Correio Eletrônico: {{ user.email }}</p>
                    <p>📷 Instagram: {{ user.instagram }}</p>
                    </div>
                {% endif %}
            {% endfor %}
            </div>
        </div>
        <div class="tab-pane" id="att_info">

            <h2 class="text-xl mb-4">Minha Conta</h2>
            <form id="formAtualizaConta" class="space-y-4">
            <div>
                <label>Email</label>
                <input type="email" name="email" value="{{ usuario.email }}" class="input" />
            </div>
            <div>
                <label>Nova Senha</label>
                <input type="password" name="senha_nova" class="input" />
            </div>
            <button class="btn btn-primary">✅ Salvar Alterações</button>
            </form>
            <button onclick="removerConta()" class="btn btn-danger mt-4">🗑️ Excluir Minha Conta</button>

        </div>
    </div>

</div>

<div id="detalheModal" class="modal" style="display: none;"></div>

{% endblock %}

{% block js %}
<script src="{{ url_for('static', filename='js/modules/membros.js') }}"></script>
<script>
function removerConta() {
  if (confirm("Tem certeza que deseja excluir sua conta?")) {
    fetch(`/usuarios/{{ usuario.username }}`, {
      method: 'DELETE',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({tipo: 'privado'})
    }).then(res => res.json()).then(res => {
      if (res.success) {
        alert('Conta removida. Você será deslogado.');
        window.location.href = '/logout';
      } else {
        alert(res.message);
      }
    });
  }
}
</script>
{% endblock %}